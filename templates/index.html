<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>é›¨å®¿ã‚Š -Amayadori-</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* å…¨ä½“ã®é›°å›²æ°—ä½œã‚Š */
        body {
            background-color: #708090;
            /* é›¨é›²ã®ã‚ˆã†ãªãƒ–ãƒ«ãƒ¼ã‚°ãƒ¬ãƒ¼ */
            color: #fff;
            font-family: "Yu Mincho", "Hiragino Mincho ProN", serif;
            /* æ˜æœä½“ã§ã—ã£ã¨ã‚Šã¨ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        /* ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        #chat-container {
            width: 90%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            /* åŠé€æ˜ */
            backdrop-filter: blur(5px);
            /* ã™ã‚Šã‚¬ãƒ©ã‚¹åŠ¹æœ */
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        #chat-box {
            height: 300px;
            overflow-y: scroll;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
            padding: 10px;
        }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦‹ãŸç›® */
        .msg {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .umbrella {
            font-size: 1.2rem;
            margin-right: 5px;
        }

        /* å…¥åŠ›æ¬„ */
        input[type="text"] {
            width: 70%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            outline: none;
        }

        button {
            width: 20%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #4682B4;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #5F9EA0;
        }

        /* æ™´ã‚Œã®æ—¥ï¼ˆé–‰åº—ï¼‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .closed-message {
            text-align: center;
        }

        .sun-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }
    </style>
</head>

<body>

    <!-- Flaskã‹ã‚‰å—ã‘å–ã£ãŸ is_open ãŒ True ã®æ™‚ã ã‘ã“ã“ã‚’è¡¨ç¤º -->
    {% if is_open %}

    <div id="chat-container">
        <h2 style="margin-top:0; font-weight:normal;">â˜” é›¨å®¿ã‚Š <small style="font-size:0.6em;">{{ weather_desc }}</small>
        </h2>
        <div id="chat-box">
            <div style="color:#ddd; font-size:0.8em; text-align:center;">
                é›¨ãŒé™ã‚Šå§‹ã‚ã¾ã—ãŸã€‚ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã‚’é–‹æ”¾ã—ã¾ã™ã€‚<br>
                é›¨ãŒæ­¢ã‚€ã¾ã§ã®é–“ã€ã”ã‚†ã£ãã‚Šã©ã†ãã€‚
            </div>
        </div>

        <div style="display:flex; justify-content:space-between;">
            <input type="text" id="message-input" placeholder="é›¨éŸ³ã«ç´›ã‚Œã¦ã¤ã¶ã‚„ã..." autocomplete="off">
            <button onclick="sendMessage()">é€ä¿¡</button>
        </div>
    </div>

    <script type="text/javascript">
        var socket = io();
        const colors = ['ğŸ”´', 'ğŸ”µ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸŸ£', 'âšª', 'ğŸŒ‚', 'â˜‚ï¸'];
        const myColor = colors[Math.floor(Math.random() * colors.length)];

        function sendMessage() {
            var input = document.getElementById('message-input');
            var text = input.value;
            if (text) {
                socket.emit('send_message', { message: text, color: myColor });
                input.value = '';
            }
        }

        socket.on('receive_message', function (data) {
            var chatBox = document.getElementById('chat-box');
            var newMsg = `<div class="msg"><span class="umbrella">${data.color}</span> ${data.message}</div>`;
            chatBox.innerHTML += newMsg;
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        document.getElementById("message-input").addEventListener("keypress", function (event) {
            if (event.key === "Enter") sendMessage();
        });
    </script>

    {% else %}

    <!-- æ™´ã‚Œã®æ™‚ï¼ˆFalseï¼‰ã¯ã“ã“ã‚’è¡¨ç¤º -->
    <div class="closed-message">
        <span class="sun-icon">â˜€</span>
        <h1>ãŸã ã„ã¾å¿«æ™´ã€‚</h1>
        <p>é›¨å®¿ã‚Šã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <p style="font-size:0.8em; color:#ccc;">ç¾åœ¨ã®æ±äº¬ï¼š{{ weather_desc }}</p>
    </div>

    {% endif %}

</body>

</html>